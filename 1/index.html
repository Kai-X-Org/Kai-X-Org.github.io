<!DOCTYPE html>
<html>
<head>
    <title>180/280A Project 1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
    </style>
</head>
<body>
    <header><h1>180/280A Project 1</h1></header>
    <h2 id="Intro">Introduction</h2>
    <p>
    This project implements image channel alignment for pictures taken with the R, G, B channels being
    separate pictures. Specifically, the target of alignment are historic pictures taken from the Prokudiin-Gorski collection.
    Each channel of an image is a separate picture, and it is our goal to find out how to shift each picture so that upon overlaying
    the three channels, we have a clear image of a snapshot of the time.
    </p>
    <h4 id="Part 1">Vanilla Alignment on Small Images</h4>
    <p>
    The vanilla logic is straightforward and works well on the small jpeg images of the collection 
    (which are around 300 by 300 pixels).
    We fix the blue image channel to be the trarget of alignment. That is we will take the red channel image, shift it by a 
    vector (x, y), and evaluate how good an alignment this is based on a metric. The x, y values of the displacement vector
    that we consider are in the range of [-14, 14]. The metric used for the 
    displayed results is the normal cross-correlation (NCC) norm, though we
    also implemented using the L2 norm as the metric. Both norms treat the images as vectors. When using
    the L2 norm, we would search of the displacement that minimizes the distance between the two image vectors. When using the 
    NCC norm, we first normalize the two image vectors and then maximize their dot product, which would mean to minimize the angles
    between the two vectors. Below are the aligment results, with the displacement computed and runtime shown.
    Note that x is vertical y is horizontal per image convention.
    </p>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/small_single/aligned_cathedral_color_vanilla_ncc_small_im_09_17_19_53.jpg" alt="vanilla 1" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
          Cathedral <br>
          Red Displacement: (3, 12) Green Displacement: (2, 5) <br>
          Runtime: 0.285s
            </figcaption>
        </figure>
        <figure style="flex: 1; text-align: center;">
        <img src="./images/small_single/aligned_monastery_color_vanilla_ncc_small_im_09_17_19_53.jpg" alt="vanilla 2" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
          Monastery <br>
          Red Displacement: (2, 3) Green Displacement: (2, -3) <br>
          Runtime: 0.414s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/small_single/aligned_tobolsk_color_vanilla_ncc_small_im_09_17_19_53.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Tobolsk <br>
          Red Displacement: (3, 7) Green Displacement: (3, 3) <br>
          Runtime: 0.475s
            </figcaption>
        </figure>
    </div>

    <p>
       We note that we have a great alignment with great run time on these smaller images, where the image is clear with no
       visible artifacting.
    </p>
    
    <h4> Image Pyramid Implementation </h4>
    <p>
    Vanilla alignment works well for the smaller images, but doing so is prohibitively expensive on larger images. This is due 
    to several reasons. On a larger image, a greater range of pixel shift has to be examined, since it takes a large number
    of pixels to cover a semantically and visually meaningful area. This results in many underlying rolling operations, which
    can be costly. The image pyramid implementation effectively implements a coarse to fine search. In our implementation, we take
    the original large images (the .tif files) and perform successive downsampling, generating a group of approximations of the 
    original images that becomes coarser and smaller. Prior to downsampling, we perform Gaussian filtering on the previous image
    to reduce aliasing. The downsample factor we used is two. For the larger images, we use sigma = 10 for the gaussian filter.
    For the smaller images, we use sigma = 3. The use of a smaller filter for the small images is to prevent "overblurring," which
    destroys the images' information. The larger sigma for large images is to account for the large size and to capture more
    surrounding features of a particular pixels. We first perform the vanilla alignment on the coarsest downsampled image. This
    process computes the displacement for that particular image. This displacement is then multiplied by our downsample factor
    (2 in our case) and serve as the origin for our alignment process for a finer, less-downsampled image. In implementation,
    we first shift the clearer image by this scaled coarse displacement first, and then consider the alignment of this shifted
    imges with its target, which we call a fine displacement. The sum of the scaled coarse displacement and the fine displacement
    is the final displacement computed that is used in later compuatation. In this fashion, we create an image pyramid.
    An implementation note is to not use too many layers, since we once again risk "overblurring" the image so that the first
    coarse displacements are incorrect. For efficiency, when we perform the image alignment, we are only operate on the center
    portions of the image that are the most feature rich and will be most useful for aligment. Otherwise, the rolling operation
    on the large image will still be quite expensive. For the results, we implemented a 4-layer pyramid for the large images and
    a 3 layer pyramid for the smaller ones. We found that in general, for the NCC norm, we can add one more layer of 
    pyramid than for the L2 norm and optain better result. In the L2 norm's case, having more layers produced bad alignment.
    This makes us think that due to the the L2 norm focusing on on absolute positions and the NCC on angles, which is a somewhat
    looser mathematical notion, the NCC metric is more robust when features are blurred.
    Below are the results. Note that for emir and melon, we end up obtain good aligment when using edges as features, which
    is shown further down the page.
    </p>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/small_pyramid/aligned_cathedral_color_2_layer_ncc_small_im_09_17_19_52.jpg" alt="vanilla 1" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
          Cathedral <br>
          Red Displacement: (3, 12) Green Displacement: (2, 5) <br>
          Runtime: 0.144s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/small_pyramid/aligned_monastery_color_2_layer_ncc_small_im_09_17_19_52.jpg" alt="vanilla 2" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
          Monastery <br>
          Red Displacement: (2, 3) Green Displacement: (2, -3) <br>
          Runtime: 0.145s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/small_pyramid/aligned_tobolsk_color_2_layer_ncc_small_im_09_17_19_52.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Tobolsk <br>
          Red Displacement: (3, 7) Green Displacement: (3, 3) <br>
          Runtime: 0.167s
            </figcaption>
        </figure>
    </div>

    <p>
    Note that for the small images, we implemented a 3 layer image pyramid.
    </p>
    <p>
    The large images:
    </p>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_church_color_3_layer_ncc_rerun.jpg" alt="vanilla 1" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
          Church <br>
          Red Displacement: (-4, 58) Green Displacement: (4, 25) <br>
          Runtime: 35.91s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_emir_color_3_layer_ncc_rerun.jpg" alt="vanilla 2" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
          Emir <br>
          Red Displacement: (41, -14) Green Displacement: (24, 48) <br>
          Runtime: 38.06s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_harvesters_edge_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Tobolsk <br>
          Red Displacement: (14, 123) Green Displacement: (17, 59) <br>
          Runtime: 37.40s
            </figcaption>
        </figure>

    </div>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_icon_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Icon <br>
          Red Displacement: (23, 90) Green Displacement: (17, 41) <br>
          Runtime: 38.19s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_italil_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Italil <br>
          Red Displacement: (36, 77) Green Displacement: (21, 38) <br>
          Runtime: 38.08s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_lastochikino_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Lastochikino <br>
          Red Displacement: (-8, 76) Green Displacement: (-2, -3) <br>
          Runtime: 37.55s
            </figcaption>
        </figure>

    </div>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_lugano_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Lugano <br>
          Red Displacement: (-29, 93) Green Displacement: (-16, 41) <br>
          Runtime: 39.68s
            </figcaption>
        </figure>


        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_melons_color_3_layer_ncc.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Melons <br>
          Red Displacement: (14, 154) Green Displacement: (10, 81) <br>
          Runtime: 37.66s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_self_portrait_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Self Portrait <br>
          Red Displacement: (37, 175) Green Displacement: (29, 78) <br>
          Runtime: 38.31s
            </figcaption>
        </figure>

    </div>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_siren_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Siren <br>
          Red Displacement: (-24, 96) Green Displacement: (-5, 49) <br>
          Runtime: 40.13s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_three_generations_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Three Generations <br>
          Red Displacement: (12, 110) Green Displacement: (15, 51) <br>
          Runtime: 37.45s
            </figcaption>
        </figure>

    </div>
    <p>
    We note that our methods obtained a good alignment on most images
    </p>
    <h4>Self Selected Images</h4>
    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/selected/aligned_adobe_color_selected_image_2.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Adobe <br>
          Red Displacement: (7, 96) Green Displacement: (10, 41) <br>
          Runtime: 36.90s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/selected/aligned_catholic_color_selected_image_3.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Catholic Monastary <br>
          Red Displacement: (-13, 113) Green Displacement: (-7, 50) <br>
          Runtime: 35.05s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/selected/aligned_dam_color_selected_image_2.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Dam <br>
          Red Displacement: (-22, 88) Green Displacement: (-14, 33) <br>
          Runtime: 37.24s
            </figcaption>
        </figure>

    </div>

    <h3>Bells and Whistles</h3>
    <h4>Cropping</h4>
    <p>
    The method for cropping is straight forward. Take an image, we first filter it with the Sobel filter, which
    gives us an image of the edges. To crop the border we consider rows/columns about (1/5 * image side length) 
    from the nearest edge. We then search for the most inner rows from the top/bottom and column form left/right that
    have an average value greater than some value. 0.05 seems to be a magic number. In the case of the full RGB image,
    we run this process over the three channels, and use the most aggressive crop optained for each side.
    Result comparisons are shown below:
    </p>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_church_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Original Church <br>
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/cropped/aligned_cropped_church_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Cropped Church <br>
            </figcaption>
        </figure>
    </div>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_harvesters_edge_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Original Harvesters <br>
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/cropped/aligned_cropped_harvesters_edge_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Cropped Harvesters <br>
            </figcaption>
        </figure>
    </div>

    <h4>Contrasting</h4>
    <p>
    For contrasting, we perform histogram equilization on the images. We see a strong effect on the resulting images:
    the colors are often more "realistic," and certain features such as the edges of the clouds become clearer.
    The contrast between adjacent color patches are also stronger, and the picture takes on less of a pastel atmosphere
    Note that in order for the pure color edges to not affect the histogram, we crop the border first using the 
    automated cropping shown above and then perform histogram equilization.
    </p>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/cropped/aligned_cropped_lastochikino_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Original Lastochikino <br>
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/hist/aligned_rescaled_histogram_lastochikino_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Histogram Equilized Lastochikino <br>
            </figcaption>
        </figure>
    </div>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/cropped/aligned_cropped_lugano_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Original Lugano <br>
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/hist/aligned_rescaled_histogram_lugano_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Histogram Equilized Lugano <br>
            </figcaption>
        </figure>
    </div>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/cropped/aligned_cropped_self_portrait_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Original Lugano <br>
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/hist/aligned_rescaled_histogram_self_portrait_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Histogram Equilized Self Portrait <br>
            </figcaption>
        </figure>
    </div>

    <h3>White Balancing</h3>
    <p>
    In white balancing, we used the gray-world algorithm, which assumes the average color of the world is gray
    and therefore treats the scene illuminant as the average RGB value. The result is shown below in the church example,
    where we note that after white balancing, the blue hue to the overall images is removed, the church's features such
    as its green roof pops out more, and we in general have a more realistic image that is less painting like.
    </p>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_lugano_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Original Lugano <br>
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/white_balance/aligned_white_balanced_lugano_color_3_layer_ncc.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            White Balanced Lugano <br>
            </figcaption>
        </figure>
    </div>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_church_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Original Church <br>
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/white_balance/aligned_white_balanced_church_color_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            White Balanced Church <br>
            </figcaption>
        </figure>
    </div>


    <h3>Color Mapping</h3>
    The color mapping algorithm we used is the histogram matching algorithm. Where given a refernce picture, we adjust the 
    color distribution of our own image such that the color distribution matches that of the reference image. A good example is
    of tobolsk below, where the reference image is a modern image of the location taken from the web, also shown below. We note
    that after the color mapping, the green hue that shrouds the image disappears, and features such as the clouds becomes a 
    lot more pronounced.
    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/color_mapped/tobolsk_ref_2.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Reference Image Taken From the Web <br>
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/small_pyramid/aligned_tobolsk_color_2_layer_ncc_small_im_09_17_19_52.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Reference Image Taken From the Web <br>
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/color_mapped/aligned_color_mapped_tobolsk_color_2_layer_ncc_small_im_09_17_19_52.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Color Mapped Tobolsk <br>
            </figcaption>
        </figure>
    </div>


    <h3>Edge as Features</h3>
    <p>
    Finally, we note that using edge as features can give us very good alignment result. Our presumed reason for this is that
    edges as features are strict on the values output of the metric functions such as L2 or NCC. In an edge image, the only
    real features are the white edges and the rest of the pixels, which is in the vast majority, are 0. In simpler terms,
    edge is a feature-sparse image.
    Therefore, any misalignment will dramatically lower the metric score. This is particularly useful in the case of the emir
    image, where the great number of repeating small color patches on the emir's clothes can confuse a color-alignment algorithm
    since partial alignment, even far off, can result in a patch of pattern aligning with a separate patch of the same pattern,
    resulting in a deceptive high metric. When aligning by edge, assume the starting error is small in the displacement, we
    would have a near-zero metric. The algorithm is therefore inclined to gravitate towards the correct alignment.
    In terms of our implementation, we applied the Sobel filter first to our original image. We then proceed to use the 
    same algorithm as in the color alignment process, except that when we downsample, we do not Gaussian-filter the image,
    since we want the image to remain feature sparse. We also note that aligning by feature is somehow faster.
    This is likely due to us not Gaussian filtering at each layer of the pyramid
    </p>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_emir_color_3_layer_ncc_rerun.jpg" alt="vanilla 2" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
          Emir Aligned By Color<br>
          Red Displacement: (41, -14) Green Displacement: (24, 48) <br>
          Runtime: 38.06s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/edge/aligned_emir_edge_3_layer_ncc_rerun.jpg" alt="vanilla 2" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
          Emir Aligned By Edge<br>
          Red Displacement: (40, 107) Green Displacement: (24, 49) <br>
          Runtime: 35.83s
            </figcaption>
        </figure>
    </div>

    <div style="display: flex; justify-content: space-around; margin-top: 2rem; margin-bottom: 2rem;">
        <figure style="flex: 1; text-align: center;">
        <img src="./images/large_pyramid/aligned_melons_color_3_layer_ncc.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Melons Aligned by Color <br>
          Red Displacement: (14, 154) Green Displacement: (10, 81) <br>
          Runtime: 36.87s
            </figcaption>
        </figure>

        <figure style="flex: 1; text-align: center;">
        <img src="./images/edge/aligned_melons_edge_3_layer_ncc_rerun.jpg" alt="vanilla 3" style="width: 100%; height: auto; display: block; margin-bottom: 10px; border-radius: 3px;">
        <figcaption style="font-size: 0.85rem; color: #2e324d;">
            Melons Aligned by Edge <br>
          Red Displacement: (13, 178) Green Displacement: (10, 81) <br>
          Runtime: 37.66s
            </figcaption>
        </figure>
    </div>

</body>
</html>
